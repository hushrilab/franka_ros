<?xml version='1.0' encoding='utf-8'?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="panda">

  <!-- =============================================================== -->
  <!-- || This file does not contain official inertial properties   || -->
  <!-- || of panda robot. The values are from the identification    || -->
  <!-- || results published in: Identification of the Franka Emika  || -->
  <!-- || PandaRobot With Retrieval of Feasible Parameters Using    || -->
  <!-- || Penalty-Based Optimization                                || -->
  <!-- || by: Claudio Gaz, Marco Cognetti, Alexander Oliva,         || -->
  <!-- || Paolo Robuffo Giordano, Alessandro de Luca                || -->
  <!-- =============================================================== -->

  <xacro:macro name="panda_arm" params="arm_id:='panda' connected_to:='' xyz:='0 0 0' rpy:='0 0 0'">
    <xacro:unless value="${not connected_to}">
      <joint name="${arm_id}_joint_${connected_to}" type="fixed">
        <parent link="${connected_to}"/>
        <child link="${arm_id}_link0"/>
        <origin rpy="${rpy}" xyz="${xyz}"/>
      </joint>
    </xacro:unless>

    <link name="${arm_id}_link0">
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/visual/link0.dae"/>
        </geometry>
      </visual>
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/collision/link0.stl"/>
        </geometry>
      </collision>
    <inertial>
      <mass value="2.92"/>
      <origin rpy="0 0 0" xyz="-0.025566 -2.88e-05 0.057332"/>
      <inertia ixx="0.00782229414331" ixy="-1.56191622996e-05" ixz="-0.00126005738123" 				iyy="0.0109027971813" iyz="1.08233858202e-05" izz="0.0102355503949"/>
    </inertial>
    </link>

    <link name="${arm_id}_link1">
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/visual/link1.dae"/>
        </geometry>
      </visual>
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/collision/link1.stl"/>
        </geometry>
      </collision>
      <inertial>
          <mass value="2.74"/>
    	  <origin rpy="0 0 0" xyz="0 -0.0324958 -0.0675818"/>
     	 <inertia ixx="0.0180416958283" ixy="0.0" ixz="0.0" iyy="0.0159136071891" 						iyz="0.0046758424612" izz="0.00620690827127"/>
    </inertial>
    </link>

    <joint name="${arm_id}_joint1" type="revolute">
      <safety_controller k_position="100.0" k_velocity="40.0" soft_lower_limit="-2.8973" soft_upper_limit="2.8973"/>
      <origin rpy="0 0 0" xyz="0 0 0.333"/>
      <parent link="${arm_id}_link0"/>
      <child link="${arm_id}_link1"/>
      <axis xyz="0 0 1"/>
      <limit acceleration="15" lower="-2.9671" effort="87" upper="2.9671" velocity="2.5"/>
      <dynamics D="1" K="7000" mu_coulomb="0" mu_viscous="16" damping="0.003" friction="0.0"/>
    </joint>

    <link name="${arm_id}_link2">
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/visual/link2.dae"/>
        </geometry>
      </visual>
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/collision/link2.stl"/>
        </geometry>
      </collision>
    <inertial>
      <mass value="2.74"/>
      <origin rpy="0 0 0" xyz="0 -0.06861 0.0322285"/>
      <inertia ixx="0.0182856182281" ixy="0.0" ixz="0.0" iyy="0.00621358421175" 						iyz="-0.00472844221905" izz="0.0161514346309"/>
    </inertial>
    </link>

    <joint name="${arm_id}_joint2" type="revolute">
      <safety_controller k_position="100.0" k_velocity="40.0" soft_lower_limit="-1.7628" soft_upper_limit="1.7628"/>
      <origin rpy="${-pi/2} 0 0" xyz="0 0 0"/>
      <parent link="${arm_id}_link1"/>
      <child link="${arm_id}_link2"/>
      <axis xyz="0 0 1"/>
      <limit acceleration="7.5" lower="-1.8326" effort="87" upper="1.8326" velocity="2.5"/>
      <dynamics D="1" K="7000" mu_coulomb="0" mu_viscous="16" damping="0.003" friction="0.0"/>
    </joint>

    <link name="${arm_id}_link3">
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/visual/link3.dae"/>
        </geometry>
      </visual>
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/collision/link3.stl"/>
        </geometry>
      </collision>
    <inertial>
      <mass value="2.38"/>
      <origin rpy="0 0 0" xyz="0.0469893 0.0316374 -0.031704"/>
      <inertia ixx="0.00771376630908" ixy="-0.00248490625138" ixz="-0.00332147581033" 			iyy="0.00989108008727" iyz="-0.00217796151484" izz="0.00811723558464"/>
    </inertial>
    </link>

    <joint name="${arm_id}_joint3" type="revolute">
      <safety_controller k_position="100.0" k_velocity="40.0" soft_lower_limit="-2.8973" soft_upper_limit="2.8973"/>
      <origin rpy="${pi/2} 0 0" xyz="0 -0.316 0"/>
      <parent link="${arm_id}_link2"/>
      <child link="${arm_id}_link3"/>
      <axis xyz="0 0 1"/>
      <limit acceleration="12.5" lower="-2.9671" effort="87" upper="2.9671" velocity="2.5"/>
      <dynamics D="1" K="7000" mu_coulomb="0" mu_viscous="16" damping="0.003" friction="0.0"/>
    </joint>

    <link name="${arm_id}_link4">
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/visual/link4.dae"/>
        </geometry>
      </visual>
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/collision/link4.stl"/>
        </geometry>
      </collision>
      <inertial>
      <mass value="2.38"/>
      <origin rpy="0 0 0" xyz="-0.0360446 0.0336853 0.031882"/>
      <inertia ixx="0.00799663881132" ixy="0.00347095570217" ixz="-0.00241222942995" 		iyy="0.00825390705278" iyz="0.00235774044121" izz="0.0102515004345"/>
    </inertial>
    </link>

    <joint name="${arm_id}_joint4" type="revolute">
      <safety_controller k_position="100.0" k_velocity="40.0" soft_lower_limit="-3.0718" soft_upper_limit="-0.0698"/>
      <origin rpy="${pi/2} 0 0" xyz="0.0825 0 0"/>
      <parent link="${arm_id}_link3"/>
      <child link="${arm_id}_link4"/>
      <axis xyz="0 0 1"/>
      <limit acceleration="12.5" lower="-3.1416" effort="87" upper="-0.4" velocity="2.5"/>
      <dynamics D="1" K="7000" mu_coulomb="0" mu_viscous="16" damping="0.003" friction="0.0"/>
    </joint>

    <link name="${arm_id}_link5">
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/visual/link5.dae"/>
        </geometry>
      </visual>
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/collision/link5.stl"/>
        </geometry>
      </collision>
      <inertial>
      <mass value="2.74"/>
      <origin rpy="0 0 0" xyz="0 0.0610427 -0.104176"/>
      <inertia ixx="0.030371374513" ixy="6.50283587108e-07" ixz="-1.05129179916e-05" 		iyy="0.0288752887402" iyz="-0.00775653445787" izz="0.00444134056164"/>
    </inertial>
    </link>

    <joint name="${arm_id}_joint5" type="revolute">
      <safety_controller k_position="100.0" k_velocity="40.0" soft_lower_limit="-2.8973" soft_upper_limit="2.8973"/>
      <origin rpy="${-pi/2} 0 0" xyz="-0.0825 0.384 0"/>
      <parent link="${arm_id}_link4"/>
      <child link="${arm_id}_link5"/>
      <axis xyz="0 0 1"/>
      <limit acceleration="15" lower="-2.9671" effort="12" upper="2.9671" velocity="3"/>
      <dynamics D="1" K="7000" mu_coulomb="0" mu_viscous="16" damping="0.003" friction="0.0"/>
    </joint>

    <link name="${arm_id}_link6">
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/visual/link6.dae"/>
        </geometry>
      </visual>
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/collision/link6.stl"/>
        </geometry>
      </collision>
      <inertial>
      <mass value="1.55"/>
      <origin rpy="0 0 0" xyz="0.0510509 0.009108 0.0106343"/>
      <inertia ixx="0.00303336450376" ixy="-0.000437276865508" ixz="0.000629257294877" 			iyy="0.00404479911567" iyz="0.000130472021025" izz="0.00558234286039"/>
    </inertial>
    </link>

    <joint name="${arm_id}_joint6" type="revolute">
      <safety_controller k_position="100.0" k_velocity="40.0" soft_lower_limit="-0.0175" soft_upper_limit="3.7525"/>
      <origin rpy="${pi/2} 0 0" xyz="0 0 0"/>
      <parent link="${arm_id}_link5"/>
      <child link="${arm_id}_link6"/>
      <axis xyz="0 0 1"/>
      <limit acceleration="20" lower="-0.0873" effort="12" upper="3.8223" velocity="3"/>
      <dynamics D="1" K="7000" mu_coulomb="0" mu_viscous="16" damping="0.003" friction="0.0"/>
    </joint>

    <link name="${arm_id}_link7">
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/visual/link7.dae"/>
        </geometry>
      </visual>
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/collision/link7.stl"/>
        </geometry>
      </collision>
      <inertial>
      <mass value="0.54"/>
      <origin rpy="0 0 0" xyz="0.0109695 0.0107965 0.0650411"/>
      <inertia ixx="0.000888868887021" ixy="-0.00012239074652" ixz="3.98699829666e-05" 			iyy="0.000888001373233" iyz="-9.33825115206e-05" izz="0.0007176834609"/>
    </inertial>
    </link>

    <joint name="${arm_id}_joint7" type="revolute">
      <safety_controller k_position="100.0" k_velocity="40.0" soft_lower_limit="-2.8973" soft_upper_limit="2.8973"/>
      <origin rpy="${pi/2} 0 0" xyz="0.088 0 0"/>
      <parent link="${arm_id}_link6"/>
      <child link="${arm_id}_link7"/>
      <axis xyz="0 0 1"/>
      <limit acceleration="20" lower="-2.9671" effort="12" upper="2.9671" velocity="3"/>
      <dynamics D="1" K="7000" mu_coulomb="0" mu_viscous="16" damping="0.003" friction="0.0"/>
    </joint>

    <link name="${arm_id}_link8" />

    <joint name="${arm_id}_joint8" type="fixed">
      <origin rpy="0 0 0" xyz="0 0 0.107"/>
      <parent link="${arm_id}_link7"/>
      <child link="${arm_id}_link8"/>
      <axis xyz="0 0 0"/>
    </joint>

  </xacro:macro>

  <xacro:macro name="hand" params="connected_to:='' ns:='' xyz:='0 0 0' rpy:='0 0 0'">
    <xacro:include filename="$(find franka_description)/robots/utils.xacro"/>

    <xacro:unless value="${connected_to == ''}">
      <joint name="${ns}_hand_joint" type="fixed">
        <parent link="${connected_to}"/>
        <child link="${ns}_hand"/>
        <origin xyz="${xyz}" rpy="${rpy}"/>
      </joint>
    </xacro:unless>

    <link name="${ns}_hand">
      <visual>
        <geometry>
          <mesh filename="package://franka_description/meshes/visual/hand.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://franka_description/meshes/collision/hand.stl" />
        </geometry>
      </collision>
      <inertial>
        <mass value="0.73" />
        <origin xyz="-0.01 0 0.03" />
        <inertia ixx="0.001" ixy="0"      ixz="0"
                             iyy="0.0025" iyz="0"
                                          izz="0.0017" />
      </inertial>
    </link>

    <xacro:macro name="finger-collision" params="sign">
      <!-- screw mount -->
      <collision>
        <origin xyz="0 ${sign}18.5e-3 11e-3" rpy="0 0 0"/>
        <geometry>
          <box size="22e-3 15e-3 20e-3" />
        </geometry>
      </collision>
      <!-- cartriage sledge -->
      <collision>
        <origin xyz="0 ${sign}6.8e-3 2.2e-3" rpy="0 0 0"/>
        <geometry>
          <box size="22e-3 8.8e-3 3.8e-3" />
        </geometry>
      </collision>
      <!-- diagonal finger -->
      <collision>
        <origin xyz="0 ${sign}15.9e-3 28.35e-3" rpy="${sign}${pi/6} 0 0"/>
        <geometry>
          <box size="17.5e-3 7e-3 23.5e-3" />
        </geometry>
      </collision>
      <!-- rubber tip with which to grasp -->
      <collision>
        <origin xyz="0 ${sign}7.58e-3 45.25e-3" rpy="0 0 0"/>
        <geometry>
          <box size="17.5e-3 15.2e-3 18.5e-3" />
        </geometry>
      </collision>
    </xacro:macro>

    <link name="${ns}_leftfinger">
      <xacro:inertia-cylinder mass="15e-3" radius="0.01" h="0.04"/>
      <visual>
        <geometry>
          <mesh filename="package://franka_description/meshes/visual/finger.dae"/>
        </geometry>
      </visual>
      <xacro:finger-collision sign="+" />
    </link>

    <link name="${ns}_rightfinger">
      <xacro:inertia-cylinder mass="15e-3" radius="0.01" h="0.04"/>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 ${pi}"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/visual/finger.dae"/>
        </geometry>
      </visual>
      <xacro:finger-collision sign="-" />
    </link>

    <!-- Friction specific material for Rubber/Rubber contact -->
    <!-- See: -->
    <xacro:gazebo-friction link="${ns}_leftfinger" mu="1.13" />
    <xacro:gazebo-friction link="${ns}_rightfinger" mu="1.13" />

    <joint name="${ns}_finger_joint1" type="prismatic">
      <parent link="${ns}_hand"/>
      <child link="${ns}_leftfinger"/>
      <origin xyz="0 0 0.0584" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
      <limit effort="100" lower="0.0" upper="0.04" velocity="0.2"/>
      <dynamics friction="0.0" damping="0.03"/>
    </joint>

    <joint name="${ns}_finger_joint2" type="prismatic">
      <parent link="${ns}_hand"/>
      <child link="${ns}_rightfinger"/>
      <origin xyz="0 0 0.0584" rpy="0 0 0"/>
      <axis xyz="0 -1 0"/>
      <limit effort="100" lower="0.0" upper="0.04" velocity="0.2"/>
      <dynamics friction="0.0" damping="0.03"/>
      <mimic joint="${ns}_finger_joint1" />
    </joint>
  </xacro:macro>
</robot>
